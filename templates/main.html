<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMBå®¢æˆ·ç«¯ - æ–‡ä»¶ç®¡ç†å™¨</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .app-container {
            display: flex;
            height: 100vh;
            background: #f5f5f5;
        }

        /* ç™»å½•ç•Œé¢ */
        .login-container {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .login-card {
            background: white;
            border-radius: 20px;
            padding: 50px 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 450px;
            animation: fadeInUp 0.6s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .login-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .login-header h1 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .login-header p {
            color: #666;
            font-size: 1.1em;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 0.95em;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: #fafafa;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group small {
            display: block;
            margin-top: 8px;
            color: #888;
            font-size: 0.85em;
        }

        .btn {
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            min-height: 40px;
            min-width: 80px;
            white-space: nowrap;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            margin: 0 2px;
            padding: 8px 12px;
            min-height: 36px;
            min-width: 70px;
            font-size: 12px;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
            margin: 0 2px;
            padding: 8px 12px;
            min-height: 36px;
            min-width: 70px;
            font-size: 12px;
        }

        .btn-success {
            background: #28a745;
            color: white;
            margin: 0 2px;
            padding: 8px 12px;
            min-height: 36px;
            min-width: 70px;
            font-size: 12px;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
            margin: 0 2px;
            padding: 8px 12px;
            min-height: 36px;
            min-width: 70px;
            font-size: 12px;
        }

        .btn-info {
            background: #17a2b8;
            color: white;
            margin: 0 2px;
            padding: 8px 12px;
            min-height: 36px;
            min-width: 70px;
            font-size: 12px;
        }
        
        /* ç»Ÿä¸€æ–‡ä»¶æ“ä½œæŒ‰é’®æ ·å¼ */
        .file-actions .btn-secondary,
        .file-actions .btn-success,
        .file-actions .btn-danger,
        .file-actions .btn-info,
        .file-actions .btn-primary {
            margin: 0;
            padding: 6px 12px;
            min-height: 32px;
            min-width: 70px;
            font-size: 11px;
            justify-content: flex-start;
            box-shadow: none;
            transform: none;
            transition: all 0.3s ease;
        }
        
        .file-actions .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
        }

        /* ç»Ÿä¸€æ–‡ä»¶æ“ä½œæŒ‰é’®å¤§å° */
        .file-actions {
            display: flex;
            flex-direction: column;
            gap: 4px;
            white-space: nowrap;
        }
        
        .file-actions .btn {
            margin: 0;
            padding: 6px 12px;
            min-height: 32px;
            min-width: 20px;
            font-size: 11px;
            justify-content: flex-start;
            border-radius: 8px;
            display: flex;
        }

        .alert {
            border-radius: 10px;
            padding: 15px 20px;
            margin: 15px 0;
            display: none;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .hidden {
            display: none !important;
        }

        /* æ–‡ä»¶æµè§ˆå™¨ç•Œé¢ */
        .main-app {
            width: 100%;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 1.8em;
            font-weight: 300;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .connection-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 0.9em;
        }

        .app-body {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .sidebar {
            width: 280px;
            background: white;
            border-right: 1px solid #e1e5e9;
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid #e1e5e9;
            background: #f8f9fa;
        }

        .sidebar-header h3 {
            color: #333;
            font-size: 1.1em;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .shares-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .share-item {
            padding: 12px 15px;
            margin: 5px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .share-item:hover {
            background: #e3f2fd;
            transform: translateX(5px);
        }

        .share-item.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .content-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: white;
        }

        .toolbar {
            padding: 20px 30px;
            border-bottom: 1px solid #e1e5e9;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f8f9fa;
        }

        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #666;
            font-size: 1.1em;
        }

        .breadcrumb-item {
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .breadcrumb-item:hover {
            color: #667eea;
        }

        .toolbar-buttons {
            display: flex;
            gap: 10px;
        }

        .file-browser {
            flex: 1;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .file-table-container {
            flex: 1;
            overflow: auto;
            padding: 20px 30px;
        }

        .file-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            table-layout: auto;
        }

        .file-table thead {
            background: #f8f9fa;
            border-bottom: 2px solid #e1e5e9;
        }

        .file-table th {
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            color: #333;
            font-size: 0.85em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        .file-table tbody tr {
            border-bottom: 1px solid #e1e5e9;
            transition: all 0.3s ease;
        }

        .file-table tbody tr:hover {
            background: #f8f9fa;
        }

        .file-table td {
            padding: 12px 15px;
            color: #333;
            max-width: 0;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .file-table td:nth-child(1) {
            /* æ–‡ä»¶ååˆ—å…è®¸æ¢è¡Œ */
            white-space: normal;
            word-wrap: break-word;
            min-width: 200px;
        }

        .file-table td:nth-child(2) {
            /* å¤§å°åˆ— */
            min-width: 80px;
            text-align: right;
        }

        .file-table td:nth-child(3) {
            /* ç±»å‹åˆ— */
            min-width: 60px;
            text-align: center;
        }

        .file-table td:nth-child(4) {
            /* ä¿®æ”¹æ—¶é—´åˆ— */
            min-width: 150px;
            text-align: center;
        }

        .file-table td:nth-child(5) {
            /* æ“ä½œåˆ— */
            min-width: 80px;
            text-align: center;
        }

        .file-icon {
            margin-right: 10px;
            font-size: 1.2em;
        }

        .file-icon.folder {
            color: #ffc107;
        }

        .file-icon.file {
            color: #6c757d;
        }

        .file-name {
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
        }

        .file-name:hover {
            color: #667eea;
        }

        .file-size {
            color: #666;
            font-size: 0.9em;
        }

        .file-modified {
            color: #666;
            font-size: 0.9em;
        }

        .file-actions {
            display: flex;
            gap: 5px;
            justify-content: center;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            gap: 10px;
            border-top: 1px solid #e1e5e9;
            background: #f8f9fa;
        }

        .page-btn {
            padding: 8px 15px;
            border: 1px solid #ddd;
            background: white;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .page-btn:hover:not(:disabled) {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .page-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .page-info {
            color: #666;
            font-size: 0.9em;
        }

        /* ä¸Šä¼ æ¨¡æ€æ¡† */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h3 {
            color: #333;
            font-size: 1.3em;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #999;
        }

        .close-btn:hover {
            color: #333;
        }

        .file-drop-area {
            border: 2px dashed #ddd;
            border-radius: 10px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-drop-area:hover {
            border-color: #667eea;
            background: #f8f9fa;
        }

        .file-drop-area.dragover {
            border-color: #667eea;
            background: #e3f2fd;
        }

        .upload-preview {
            margin-top: 20px;
        }

        .upload-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border: 1px solid #e1e5e9;
            border-radius: 5px;
            margin-bottom: 10px;
        }

        .progress-bar {
            width: 200px;
            height: 6px;
            background: #e1e5e9;
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            transition: width 0.3s ease;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .login-card {
                margin: 20px;
                max-width: none;
                padding: 40px 30px;
            }
            
            .sidebar {
                width: 250px;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .toolbar {
                flex-direction: column;
                gap: 15px;
            }
            
            .file-table {
                font-size: 0.85em;
            }
            
            .file-table th,
            .file-table td {
                padding: 8px 10px;
            }
            
            .file-table td:nth-child(1) {
                min-width: 150px;
            }
            
            .file-table td:nth-child(2),
            .file-table td:nth-child(3) {
                min-width: 60px;
            }
            
            .file-table td:nth-child(4) {
                min-width: 120px;
            }
            
            .file-table td:nth-child(5) {
                min-width: 60px;
            }
        }

        @media (max-width: 576px) {
            .login-card {
                margin: 10px;
                padding: 30px 20px;
            }
            
            .login-header h1 {
                font-size: 1.8em;
            }
            
            .login-header p {
                font-size: 0.9em;
            }
            
            .file-table th,
            .file-table td {
                padding: 6px 8px;
                font-size: 0.8em;
            }
            
            .file-table th:nth-child(4),
            .file-table td:nth-child(4) {
                display: none; /* éšè—ä¿®æ”¹æ—¶é—´åˆ— */
            }
            
            .app-body {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: 200px;
                border-right: none;
                border-bottom: 1px solid #e1e5e9;
            }
            
            .file-actions {
                flex-direction: column;
            }
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .empty-state i {
            font-size: 4em;
            margin-bottom: 20px;
            color: #ddd;
        }

        .empty-state h3 {
            font-size: 1.3em;
            margin-bottom: 10px;
            color: #999;
        }

        .empty-state p {
            color: #bbb;
        }
    </style>
</head>
<body>
    <!-- ç™»å½•ç•Œé¢ -->
    <div id="loginPage" class="login-container">
        <div class="login-card">
            <div class="login-header">
                <h1><i class="fas fa-network-wired"></i> SMB Client</h1>
                <p>å®‰å…¨çš„ç½‘ç»œæ–‡ä»¶ç®¡ç†å·¥å…·</p>
            </div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label for="connectionString">
                        <i class="fas fa-link"></i> SMBè¿æ¥å­—ç¬¦ä¸²
                    </label>
                    <input type="text" id="connectionString" name="connectionString" required
                           placeholder="ä¾‹å¦‚: administrator:123456@192.168.10.3"
                           value="administrator:123456@192.168.10.3">
                    <small>
                        æ”¯æŒæ ¼å¼:<br>
                        â€¢ username:password@server<br>
                        â€¢ DOMAIN\\username:password@server<br>
                        â€¢ username:password@server:port<br>
                        â€¢ DOMAIN\\username:password@server:port
                    </small>
                </div>
                
                                    
                                    
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-sign-in-alt"></i> è¿æ¥
                </button>
                
                <div id="error" class="alert alert-error"></div>
                <div id="success" class="alert alert-success"></div>
            </form>
        </div>
    </div>

    <!-- æ–‡ä»¶æµè§ˆå™¨ç•Œé¢ -->
    <div id="browserPage" class="app-container hidden">
        <div class="main-app">
            <header class="header">
                <h1>
                    <i class="fas fa-folder-open"></i>
                    SMB æ–‡ä»¶ç®¡ç†å™¨
                </h1>
                <div class="connection-info">
                    <i class="fas fa-network-wired"></i>
                    <span id="connectionInfo">æœªè¿æ¥</span>
                </div>
            </header>
            
            <div class="app-body">
                <!-- ä¾§è¾¹æ  -->
                <aside class="sidebar">
                    <div class="sidebar-header">
                        <h3>
                            <i class="fas fa-share-alt"></i>
                            ç½‘ç»œå…±äº«
                        </h3>
                    </div>
                    <div class="shares-list" id="sharesList">
                        <div class="share-item active">
                            <i class="fas fa-sync-alt loading"></i>
                            <span>åŠ è½½å…±äº«åˆ—è¡¨ä¸­...</span>
                        </div>
                    </div>
                </aside>
                
                <!-- ä¸»å†…å®¹åŒºåŸŸ -->
                <main class="content-area">
                    <div class="toolbar">
                        <div class="breadcrumb" id="breadcrumb">
                            <i class="fas fa-home breadcrumb-item"></i>
                            <span>/</span>
                        </div>
                        
                        <div class="toolbar-buttons">
                            <button id="refreshBtn" class="btn btn-info">
                                <i class="fas fa-sync-alt"></i> åˆ·æ–°
                            </button>
                            <button id="uploadBtn" class="btn btn-success">
                                <i class="fas fa-upload"></i> ä¸Šä¼ 
                            </button>
                            <button id="disconnectBtn" class="btn btn-danger">
                                <i class="fas fa-sign-out-alt"></i> æ–­å¼€
                            </button>
                        </div>
                    </div>
                    
                    <div class="file-browser">
                        <div class="file-table-container">
                            <table class="file-table">
                                <thead>
                                    <tr>
                                        <th width="40%">åç§°</th>
                                        <th width="20%">å¤§å°</th>
                                        <th width="20%">ç±»å‹</th>
                                        <th width="20%">ä¿®æ”¹æ—¶é—´</th>
                                        <th width="20%">æ“ä½œ</th>
                                    </tr>
                                </thead>
                                <tbody id="fileTableBody">
                                    <tr>
                                        <td colspan="5">
                                            <div class="empty-state">
                                                <i class="fas fa-folder-open"></i>
                                                <h3>æ¬¢è¿ä½¿ç”¨SMBæ–‡ä»¶ç®¡ç†å™¨</h3>
                                                <p>è¯·ä»å·¦ä¾§é€‰æ‹©ä¸€ä¸ªå…±äº«æ–‡ä»¶å¤¹</p>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="pagination" id="pagination">
                            <button class="page-btn" id="prevBtn" disabled>
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <span class="page-info">ç¬¬ 1 é¡µï¼Œå…± 1 é¡µ</span>
                            <button class="page-btn" id="nextBtn" disabled>
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </main>
            </div>
        </div>
    </div>

    <!-- ä¸Šä¼ æ–‡ä»¶æ¨¡æ€æ¡† -->
    <div id="uploadModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-upload"></i> ä¸Šä¼ æ–‡ä»¶</h3>
                <button class="close-btn" onclick="closeUploadModal()">&times;</button>
            </div>
            <div class="file-drop-area" id="dropArea">
                <i class="fas fa-cloud-upload-alt" style="font-size: 3em; color: #667eea; margin-bottom: 15px;"></i>
                <h3>æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„ä¸Šä¼ </h3>
                <p>æˆ–è€…</p>
                <input type="file" id="fileInput" multiple style="display: none;">
                <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                    é€‰æ‹©æ–‡ä»¶
                </button>
            </div>
            <div class="upload-preview" id="uploadPreview"></div>
            <div style="margin-top: 20px; text-align: right;">
                <button class="btn btn-secondary" onclick="closeUploadModal()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="startUpload()">
                    <i class="fas fa-upload"></i> å¼€å§‹ä¸Šä¼ 
                </button>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentShare = null;
        let currentPath = '\\';
        let currentPage = 1;
        let itemsPerPage = 10;
        let allFiles = [];
        let connectionInfo = {};

        // DOMå…ƒç´ 
        const elements = {
            loginPage: document.getElementById('loginPage'),
            browserPage: document.getElementById('browserPage'),
            loginForm: document.getElementById('loginForm'),
            error: document.getElementById('error'),
            success: document.getElementById('success'),
            connectionInfo: document.getElementById('connectionInfo'),
            sharesList: document.getElementById('sharesList'),
            fileTableBody: document.getElementById('fileTableBody'),
            breadcrumb: document.getElementById('breadcrumb'),
            pagination: document.getElementById('pagination'),
            uploadModal: document.getElementById('uploadModal'),
            dropArea: document.getElementById('dropArea'),
            fileInput: document.getElementById('fileInput'),
            uploadPreview: document.getElementById('uploadPreview')
        };

        // è¿æ¥æ–¹å¼åˆ‡æ¢
        function toggleConnectionType() {
            const connectionType = document.getElementById('connectionType').value;
            const manualForm = document.getElementById('manualForm');
            const connectionStringForm = document.getElementById('connectionStringForm');
            const manualAuth = document.getElementById('manualAuth');
            
            if (connectionType === 'manual') {
                manualForm.classList.remove('hidden');
                connectionStringForm.classList.add('hidden');
                manualAuth.style.display = 'block';
                document.getElementById('server').required = true;
                document.getElementById('connectionString').required = false;
            } else {
                manualForm.classList.add('hidden');
                connectionStringForm.classList.remove('hidden');
                manualAuth.style.display = 'none';
                document.getElementById('server').required = false;
                document.getElementById('connectionString').required = true;
            }
        }

        // è®¤è¯æ–¹å¼åˆ‡æ¢
        function toggleAuthType() {
            const authType = document.getElementById('authType').value;
            const passwordGroup = document.getElementById('passwordGroup');
            const hashGroup = document.getElementById('hashGroup');
            
            if (authType === 'password') {
                passwordGroup.classList.remove('hidden');
                hashGroup.classList.add('hidden');
                document.getElementById('password').required = false;
                document.getElementById('hash').required = false;
            } else {
                passwordGroup.classList.add('hidden');
                hashGroup.classList.remove('hidden');
                document.getElementById('password').required = false;
                document.getElementById('hash').required = true;
            }
        }

        // æ˜¾ç¤ºé”™è¯¯/æˆåŠŸæ¶ˆæ¯
        function showError(message, duration = 5000) {
            elements.error.textContent = message;
            elements.error.style.display = 'block';
            elements.success.style.display = 'none';
            
            if (duration > 0) {
                setTimeout(() => {
                    elements.error.style.display = 'none';
                }, duration);
            }
        }

        function showSuccess(message, duration = 3000) {
            elements.success.textContent = message;
            elements.success.style.display = 'block';
            elements.error.style.display = 'none';
            
            if (duration > 0) {
                setTimeout(() => {
                    elements.success.style.display = 'none';
                }, duration);
            }
        }

        // å¤„ç†ç™»å½•è¡¨å•æäº¤
        elements.loginForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // æ£€æŸ¥PyWebViewæ˜¯å¦å¯ç”¨
            if (!checkPyWebViewReady()) {
                showError('ç³»ç»Ÿæœªå°±ç»ªï¼Œè¯·ç¨åå†è¯•');
                return;
            }
            
            const formData = new FormData(this);
            const connectionString = formData.get('connectionString');
            
            // ç›´æ¥ä½¿ç”¨è¿æ¥å­—ç¬¦ä¸²
            const data = {
                connection_string: connectionString
            };
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalContent = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> è¿æ¥ä¸­...';
            submitBtn.disabled = true;
            
            try {
                console.log('ğŸ”— [å‰ç«¯è°ƒç”¨] å‡†å¤‡è°ƒç”¨ pywebview.api.connect');
                console.log('ğŸ”— [å‰ç«¯è°ƒç”¨] å‚æ•°:', data.connection_string);
                const result = await pywebview.api.connect(data.connection_string);
                console.log('ğŸ”— [å‰ç«¯è°ƒç”¨] pywebview.api.connect è¿”å›:', result);
                
                if (result.success) {
                    showSuccess('è¿æ¥æˆåŠŸï¼æ­£åœ¨åŠ è½½...');
                    
                    // ä¿å­˜è¿æ¥ä¿¡æ¯
                    connectionInfo = data;
                    
                    setTimeout(() => {
                        showBrowserPage();
                    }, 1000);
                } else {
                    showError(result.error || 'è¿æ¥å¤±è´¥');
                }
            } catch (error) {
                showError('è¿æ¥é”™è¯¯: ' + error.message);
            } finally {
                submitBtn.innerHTML = originalContent;
                submitBtn.disabled = false;
            }
        });

        // æ˜¾ç¤ºæ–‡ä»¶æµè§ˆå™¨é¡µé¢
        function showBrowserPage() {
            elements.loginPage.classList.add('hidden');
            elements.browserPage.classList.remove('hidden');
            
            // æ›´æ–°è¿æ¥ä¿¡æ¯æ˜¾ç¤º
            if (connectionInfo.connection_string) {
                elements.connectionInfo.textContent = connectionInfo.connection_string;
            } else {
                const server = connectionInfo.server || 'Unknown';
                const username = connectionInfo.username || 'Anonymous';
                elements.connectionInfo.textContent = `${username}@${server}`;
            }
            
            // åŠ è½½å…±äº«åˆ—è¡¨
            loadShares();
        }

        // æ˜¾ç¤ºç™»å½•é¡µé¢
        function showLoginPage() {
            elements.browserPage.classList.add('hidden');
            elements.loginPage.classList.remove('hidden');
        }

        // åŠ è½½å…±äº«åˆ—è¡¨
        async function loadShares() {
            console.log('å¼€å§‹åŠ è½½å…±äº«åˆ—è¡¨...');
            elements.sharesList.innerHTML = '<div class="share-item"><i class="fas fa-sync-alt loading"></i><span>åŠ è½½å…±äº«åˆ—è¡¨ä¸­...</span></div>';
            
            try {
                console.log('ğŸ“ [å‰ç«¯è°ƒç”¨] å‡†å¤‡è°ƒç”¨ pywebview.api.list_files');
                console.log('ğŸ“ [å‰ç«¯è°ƒç”¨] å‚æ•°: \\\\\\\\');
                const result = await pywebview.api.list_files('\\\\');
                console.log('ğŸ“ [å‰ç«¯è°ƒç”¨] pywebview.api.list_files è¿”å›:', result);
                
                if (result.success) {
                    console.log('å…±äº«åˆ—è¡¨åŠ è½½æˆåŠŸï¼Œå…±äº«æ•°é‡:', result.files ? result.files.length : 0);
                    displayShares(result.files);
                } else {
                    console.error('å…±äº«åˆ—è¡¨åŠ è½½å¤±è´¥:', result.error);
                    elements.sharesList.innerHTML = `<div class="share-item"><i class="fas fa-exclamation-triangle" style="color: #dc3545;"></i><span>åŠ è½½å¤±è´¥: ${result.error}</span></div>`;
                }
            } catch (error) {
                console.error('å…±äº«åˆ—è¡¨ç½‘ç»œé”™è¯¯:', error);
                elements.sharesList.innerHTML = '<div class="share-item"><i class="fas fa-exclamation-triangle" style="color: #dc3545;"></i><span>ç½‘ç»œé”™è¯¯: ' + error.message + '</span></div>';
            }
        }

        // æ˜¾ç¤ºå…±äº«åˆ—è¡¨
        function displayShares(shares) {
            console.log('å¼€å§‹æ˜¾ç¤ºå…±äº«åˆ—è¡¨ï¼Œå…±äº«æ•°é‡:', shares ? shares.length : 0);
            console.log('å…±äº«åˆ—è¡¨è¯¦æƒ…:', shares);
            
            if (!shares || shares.length === 0) {
                console.log('æ²¡æœ‰æ‰¾åˆ°å…±äº«ï¼Œæ˜¾ç¤ºç©ºçŠ¶æ€');
                elements.sharesList.innerHTML = '<div class="share-item"><i class="fas fa-info-circle"></i><span>æ²¡æœ‰æ‰¾åˆ°å…±äº«</span></div>';
                return;
            }
            
            const html = shares.map((share, index) => {
                console.log(`å¤„ç†å…±äº« ${index + 1}:`, share);
                return `
                    <div class="share-item" onclick="selectShare('${share.name}', '${share.name}')" title="ç±»å‹: ${share.type || 'æœªçŸ¥'}\nå±æ€§: ${share.attributes || 'æ— '}">
                        <i class="fas fa-share-alt ${share.is_directory ? 'folder' : 'file'}"></i>
                        <span>${share.name}</span>
                    </div>
                `;
            }).join('');
            
            console.log('å…±äº«åˆ—è¡¨HTMLç”Ÿæˆå®Œæˆ');
            elements.sharesList.innerHTML = html;
            console.log('å…±äº«åˆ—è¡¨æ˜¾ç¤ºå®Œæˆ');
        }

        // é€‰æ‹©å…±äº«
        function selectShare(shareName, displayName) {
            console.log('é€‰æ‹©å…±äº«:', shareName, displayName);
            currentShare = shareName;
            currentPath = '\\' + shareName; // ç›´æ¥è®¾ç½®ä¸ºå…±äº«è·¯å¾„
            currentPage = 1;
            
            // æ›´æ–°ä¾§è¾¹æ é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.share-item').forEach(item => {
                item.classList.remove('active');
            });
            if (event && event.target) {
                const shareItem = event.target.closest('.share-item');
                if (shareItem) {
                    shareItem.classList.add('active');
                }
            }
            
            console.log('å¼€å§‹åŠ è½½å…±äº«æ–‡ä»¶åˆ—è¡¨ï¼Œè·¯å¾„:', currentPath);
            // åŠ è½½å…±äº«å†…çš„æ–‡ä»¶åˆ—è¡¨
            loadFiles(currentPath);
            
            // æ›´æ–°é¢åŒ…å±‘
            updateBreadcrumb();
        }

        // åŠ è½½æ–‡ä»¶åˆ—è¡¨
        async function loadFiles(path) {
            console.log('å¼€å§‹åŠ è½½æ–‡ä»¶åˆ—è¡¨ï¼Œè·¯å¾„:', path);
            console.log('å½“å‰å…±äº«:', currentShare);
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            elements.fileTableBody.innerHTML = '<tr><td colspan="5"><div style="text-align: center; padding: 40px;"><i class="fas fa-sync-alt loading"></i> åŠ è½½ä¸­...</div></td></tr>';
            
            try {
                console.log('ğŸ“ [å‰ç«¯è°ƒç”¨] å‡†å¤‡è°ƒç”¨ pywebview.api.list_files');
                console.log('ğŸ“ [å‰ç«¯è°ƒç”¨] å‚æ•°:', path);
                const result = await pywebview.api.list_files(path);
                console.log('ğŸ“ [å‰ç«¯è°ƒç”¨] pywebview.api.list_files è¿”å›:', result);
                
                if (result.success) {
                    console.log('æ–‡ä»¶åˆ—è¡¨åŠ è½½æˆåŠŸï¼Œæ–‡ä»¶æ•°é‡:', result.files ? result.files.length : 0);
                    if (result.files) {
                        console.log('å‰5ä¸ªæ–‡ä»¶:', result.files.slice(0, 5));
                    }
                    allFiles = result.files || [];
                    // æ–‡ä»¶å¤¹å‰ç½®æ’åº
                    allFiles.sort((a, b) => {
                        // æ–‡ä»¶å¤¹ä¼˜å…ˆ
                        if (a.is_directory && !b.is_directory) return -1;
                        if (!a.is_directory && b.is_directory) return 1;
                        // åŒç±»å‹æŒ‰åç§°æ’åº
                        return a.name.localeCompare(b.name);
                    });
                    displayFiles();
                } else {
                    console.error('æ–‡ä»¶åˆ—è¡¨åŠ è½½å¤±è´¥:', result.error);
                    elements.fileTableBody.innerHTML = `<tr><td colspan="5"><div style="text-align: center; padding: 40px; color: #dc3545;"><i class="fas fa-exclamation-triangle"></i> åŠ è½½å¤±è´¥: ${result.error}</div></td></tr>`;
                }
            } catch (error) {
                console.error('æ–‡ä»¶åˆ—è¡¨ç½‘ç»œé”™è¯¯:', error);
                elements.fileTableBody.innerHTML = '<tr><td colspan="5"><div style="text-align: center; padding: 40px; color: #dc3545;"><i class="fas fa-exclamation-triangle"></i> ç½‘ç»œé”™è¯¯: ' + error.message + '</div></td></tr>';
            }
        }

        // æ˜¾ç¤ºæ–‡ä»¶åˆ—è¡¨ï¼ˆå¸¦åˆ†é¡µï¼‰
        function displayFiles() {
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageFiles = allFiles.slice(startIndex, endIndex);
            
            if (pageFiles.length === 0 && allFiles.length === 0) {
                elements.fileTableBody.innerHTML = `
                    <tr>
                        <td colspan="5">
                            <div class="empty-state">
                                <i class="fas fa-folder-open"></i>
                                <h3>æ–‡ä»¶å¤¹ä¸ºç©º</h3>
                                <p>æ­¤æ–‡ä»¶å¤¹ä¸­æ²¡æœ‰æ–‡ä»¶æˆ–å­æ–‡ä»¶å¤¹</p>
                            </div>
                        </td>
                    </tr>
                `;
                updatePagination(0);
                return;
            }
            
            if (pageFiles.length === 0 && currentPage > 1) {
                currentPage--;
                displayFiles();
                return;
            }
            
            const html = pageFiles.map(file => {
                const icon = file.is_directory ? 'folder' : 'file';
                const typeText = file.is_directory ? 'æ–‡ä»¶å¤¹' : 'æ–‡ä»¶';
                
                return `
                    <tr>
                        <td>
                            <div class="file-name" onclick="${file.is_directory ? `navigateToDirectory('${file.name}')` : `handleFileClick('${file.name}', ${file.size})`}">
                                <i class="fas fa-${icon} file-icon ${icon}"></i>
                                ${file.name}
                            </div>
                        </td>
                        <td>
                            <span class="file-size">${file.is_directory ? '-' : formatFileSize(file.size)}</span>
                        </td>
                        <td>
                            <span class="file-size">${typeText}</span>
                        </td>
                        <td>
                            <span class="file-modified">${file.modified_time || '-'}</span>
                        </td>
                        <td>
                            <div class="file-actions">
                                <button class="btn btn-primary" onclick="handleFileAction('${file.name}', ${file.is_directory})" title="æŸ¥çœ‹">
                                    <i class="fas fa-${file.is_directory ? 'folder-open' : 'eye'}"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
            
            elements.fileTableBody.innerHTML = html;
            updatePagination(allFiles.length);
        }

        // å¯¼èˆªåˆ°ç›®å½•
        function navigateToDirectory(dirName) {
            if (dirName === '..') {
                currentPath = getParentPath(currentPath);
            } else {
                currentPath = currentPath.endsWith('\\') ? 
                    currentPath + dirName : currentPath + '\\' + dirName;
            }
            
            currentPage = 1;
            loadFiles(currentPath);
            updateBreadcrumb();
        }

        // ç»Ÿä¸€å¤„ç†æ–‡ä»¶æ“ä½œ
        function handleFileAction(fileName, isDirectory) {
            if (isDirectory) {
                // å¦‚æœæ˜¯æ–‡ä»¶å¤¹ï¼Œåˆ™è¿›å…¥ç›®å½•
                navigateToDirectory(fileName);
            } else {
                // å¦‚æœæ˜¯æ–‡ä»¶ï¼Œåˆ™æ˜¾ç¤ºæ“ä½œé€‰é¡¹ï¼ˆä¸‹è½½ã€æŸ¥çœ‹è¯¦æƒ…ç­‰ï¼‰
                showFileActionMenu(fileName);
            }
        }
        
        // å¤„ç†æ–‡ä»¶ç‚¹å‡»äº‹ä»¶
        function handleFileClick(fileName, fileSize) {
            const canView = isViewableFile(fileName, fileSize);
            
            if (canView) {
                // å¯æŸ¥çœ‹æ–‡ä»¶ç›´æ¥å¼¹å‡ºæŸ¥çœ‹æ¡†
                viewFileContent(fileName);
            } else {
                // ä¸å¯æŸ¥çœ‹æ–‡ä»¶æ˜¾ç¤ºæç¤º
                let reason = '';
                if (fileSize > 2 * 1024 * 1024) {
                    reason = 'æ–‡ä»¶è¿‡å¤§ï¼ˆè¶…è¿‡2MBï¼‰';
                } else {
                    reason = 'æ–‡ä»¶ç±»å‹ä¸æ”¯æŒåœ¨çº¿é¢„è§ˆ';
                }
                showTempMessage(`æ–‡ä»¶${reason}ï¼Œå»ºè®®ä¸‹è½½åˆ°æœ¬åœ°æŸ¥çœ‹`, 2000);
            }
        }
        
        // æ˜¾ç¤ºä¸´æ—¶æ¶ˆæ¯ï¼ˆ2ç§’åè‡ªåŠ¨æ¶ˆå¤±ï¼‰
        function showTempMessage(message, duration = 2000) {
            // åˆ›å»ºæ¶ˆæ¯å…ƒç´ 
            const messageEl = document.createElement('div');
            messageEl.className = 'temp-message';
            messageEl.textContent = message;
            messageEl.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #ff9800;
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.15);
                z-index: 10000;
                font-size: 14px;
                max-width: 300px;
                word-wrap: break-word;
            `;
            
            document.body.appendChild(messageEl);
            
            // åŠ¨ç”»æ•ˆæœ
            setTimeout(() => {
                messageEl.style.transition = 'opacity 0.3s ease';
                messageEl.style.opacity = '0.9';
            }, 10);
            
            // å®šæ—¶ç§»é™¤
            setTimeout(() => {
                if (messageEl.parentNode) {
                    messageEl.style.opacity = '0';
                    setTimeout(() => {
                        if (messageEl.parentNode) {
                            document.body.removeChild(messageEl);
                        }
                    }, 300);
                }
            }, duration);
        }

        // æ˜¾ç¤ºæ–‡ä»¶æ“ä½œèœå•
        function showFileActionMenu(fileName) {
            // æ£€æŸ¥æ–‡ä»¶å¤§å°å’Œç±»å‹
            const file = allFiles.find(f => f.name === fileName);
            if (!file) return;
            
            const canView = isViewableFile(fileName, file.size);
            
            let options = '';
            if (canView) {
                options += `<button class="btn btn-success" onclick="viewFileContent('${fileName}')">
                    <i class="fas fa-eye"></i> æŸ¥çœ‹
                </button>`;
            } else {
                // æ–‡ä»¶ä¸å¯æŸ¥çœ‹æ—¶æ˜¾ç¤ºæç¤º
                let reason = '';
                if (file.size > 2 * 1024 * 1024) {
                    reason = 'æ–‡ä»¶è¿‡å¤§';
                } else {
                    reason = 'æ–‡ä»¶ç±»å‹ä¸æ”¯æŒé¢„è§ˆ';
                }
                options += `<button class="btn btn-secondary" onclick="alert('æ–‡ä»¶${reason}ï¼Œå»ºè®®ä¸‹è½½åˆ°æœ¬åœ°æŸ¥çœ‹')" title="${reason}">
                    <i class="fas fa-eye-slash"></i> æŸ¥çœ‹
                </button>`;
            }
            options += `<button class="btn btn-primary" onclick="downloadFile('${fileName}')">
                <i class="fas fa-download"></i> ä¸‹è½½
            </button>`;
            options += `<button class="btn btn-info" onclick="viewFileInfo('${fileName}')">
                <i class="fas fa-info-circle"></i> è¯¦æƒ…
            </button>`;
            
            // ç®€å•çš„æ¨¡æ€æ¡†æ˜¾ç¤ºé€‰é¡¹
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                background: white; padding: 20px; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                z-index: 1000; max-width: 400px; text-align: center;
            `;
            modal.innerHTML = `
                <h3>æ–‡ä»¶æ“ä½œ: ${fileName}</h3>
                <p>å¤§å°: ${formatFileSize(file.size)}</p>
                <div style="margin-top: 15px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                    ${options}
                </div>
                <button class="btn btn-secondary" onclick="this.parentElement.parentElement.remove()" style="margin-top: 10px;">
                    å–æ¶ˆ
                </button>
            `;
            
            // æ·»åŠ èƒŒæ™¯é®ç½©
            const overlay = document.createElement('div');
            overlay.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 999;';
            
            // å®‰å…¨ç§»é™¤æ¨¡æ€æ¡†çš„å‡½æ•°
            const safeRemoveModal = () => {
                try {
                    if (overlay && overlay.parentNode) {
                        overlay.parentNode.removeChild(overlay);
                    }
                    if (modal && modal.parentNode) {
                        modal.parentNode.removeChild(modal);
                    }
                } catch (e) {
                    console.warn('ç§»é™¤æ¨¡æ€æ¡†æ—¶å‡ºé”™:', e);
                }
            };
            
            overlay.onclick = safeRemoveModal;
            
            document.body.appendChild(overlay);
            document.body.appendChild(modal);
            
            // ä¿®æ”¹å–æ¶ˆæŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶
            setTimeout(() => {
                const cancelBtn = modal.querySelector('button[onclick*="remove"]');
                if (cancelBtn) {
                    cancelBtn.onclick = safeRemoveModal;
                }
            }, 100);
        }

        // æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å¯æŸ¥çœ‹
        function isViewableFile(fileName, fileSize) {
            // æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼Œå¦‚æœå¤§äº2MBåˆ™ä¸å»ºè®®åœ¨çº¿æŸ¥çœ‹
            const MAX_VIEW_SIZE = 2 * 1024 * 1024; // 2MB
            if (fileSize > MAX_VIEW_SIZE) {
                return false;
            }
            
            const extension = fileName.toLowerCase().split('.').pop();
            const viewableExtensions = ['txt', 'log', 'ini', 'conf', 'md', 'json', 'xml', 'csv', 
                                       'jpg', 'jpeg', 'png', 'gif', 'bmp', 'webp', 'jsp', 'jspx', 'html', 'py', 'sh', 'js', 'css', 'bat'];
            
            return viewableExtensions.includes(extension);
        }

        // ä¸‹è½½æ–‡ä»¶
        async function downloadFile(fileName) {
            if (!currentShare) {
                showError('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªå…±äº«æ–‡ä»¶å¤¹');
                return;
            }
            
            try {
                showSuccess('å¼€å§‹ä¸‹è½½æ–‡ä»¶...');
                console.log('ä¸‹è½½æ–‡ä»¶ - å½“å‰å…±äº«:', currentShare, 'å½“å‰è·¯å¾„:', currentPath, 'æ–‡ä»¶å:', fileName);
                
                // æ„é€ æ­£ç¡®çš„æ–‡ä»¶è·¯å¾„
                let filePath;
                if (currentPath === '\\') {
                    // æ ¹ç›®å½•ï¼Œç›´æ¥ä½¿ç”¨æ–‡ä»¶å
                    filePath = fileName;
                } else if (currentPath.startsWith('\\' + currentShare)) {
                    // å¦‚æœå½“å‰è·¯å¾„åŒ…å«å…±äº«åï¼Œåˆ™æå–ç›¸å¯¹è·¯å¾„
                    const relativePath = currentPath.substring(('\\' + currentShare).length).replace(/^\\+/, '');
                    filePath = relativePath ? relativePath + '\\' + fileName : fileName;
                } else {
                    // å¦åˆ™ç›´æ¥æ‹¼æ¥
                    const cleanPath = currentPath.replace(/^\\+/, '').replace(/\\+$/, '');
                    filePath = cleanPath ? cleanPath + '\\' + fileName : fileName;
                }
                
                console.log('æ„é€ çš„æ–‡ä»¶è·¯å¾„:', filePath);
                
                // è°ƒç”¨åç«¯ä¸‹è½½API (ä¿å­˜åˆ°downloadç›®å½•)
                console.log('â¬‡ï¸ [å‰ç«¯è°ƒç”¨] å‡†å¤‡è°ƒç”¨ pywebview.api.download_file (ä¿å­˜åˆ°downloadç›®å½•)');
                console.log('â¬‡ï¸ [å‰ç«¯è°ƒç”¨] å‚æ•°:', { currentShare, filePath });
                const result = await pywebview.api.download_file(currentShare, filePath, null, true);
                console.log('â¬‡ï¸ [å‰ç«¯è°ƒç”¨] pywebview.api.download_file è¿”å›:', result);
                
                if (result.success) {
                    // æ˜¾ç¤ºæ›´è¯¦ç»†çš„ä¸‹è½½æˆåŠŸä¿¡æ¯
                    const message = `æ–‡ä»¶ "${fileName}" ä¸‹è½½æˆåŠŸï¼\n\nä¿å­˜ä½ç½®: ${result.local_path || 'downloadç›®å½•'}\næ–‡ä»¶å¤§å°: ${formatFileSize(result.size || 0)}`;
                    showSuccess(message);
                } else {
                    showError(`ä¸‹è½½å¤±è´¥: ${result.error}`);
                }
            } catch (error) {
                showError(`ä¸‹è½½é”™è¯¯: ${error.message}`);
            }
        }

        // æŸ¥çœ‹æ–‡ä»¶å†…å®¹
        async function viewFileContent(fileName) {
            if (!currentShare) {
                showError('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªå…±äº«æ–‡ä»¶å¤¹');
                return;
            }
            
            try {
                console.log('æŸ¥çœ‹æ–‡ä»¶ - å½“å‰å…±äº«:', currentShare, 'å½“å‰è·¯å¾„:', currentPath, 'æ–‡ä»¶å:', fileName);
                
                // æ„é€ æ­£ç¡®çš„æ–‡ä»¶è·¯å¾„
                let filePath;
                if (currentPath === '\\') {
                    // æ ¹ç›®å½•ï¼Œç›´æ¥ä½¿ç”¨æ–‡ä»¶å
                    filePath = fileName;
                } else if (currentPath.startsWith('\\' + currentShare)) {
                    // å¦‚æœå½“å‰è·¯å¾„åŒ…å«å…±äº«åï¼Œåˆ™æå–ç›¸å¯¹è·¯å¾„
                    const relativePath = currentPath.substring(('\\' + currentShare).length).replace(/^\\+/, '');
                    filePath = relativePath ? relativePath + '\\' + fileName : fileName;
                } else {
                    // å¦åˆ™ç›´æ¥æ‹¼æ¥
                    const cleanPath = currentPath.replace(/^\\+/, '').replace(/\\+$/, '');
                    filePath = cleanPath ? cleanPath + '\\' + fileName : fileName;
                }
                
                console.log('æ„é€ çš„æ–‡ä»¶è·¯å¾„:', filePath);
                
                console.log('ğŸ‘ï¸ [å‰ç«¯è°ƒç”¨] å‡†å¤‡è°ƒç”¨ pywebview.api.download_file (æŸ¥çœ‹å†…å®¹)');
                console.log('ğŸ‘ï¸ [å‰ç«¯è°ƒç”¨] å‚æ•°:', { currentShare, filePath });
                const result = await pywebview.api.download_file(currentShare, filePath);
                console.log('ğŸ‘ï¸ [å‰ç«¯è°ƒç”¨] pywebview.api.download_file (æŸ¥çœ‹å†…å®¹) è¿”å›:', result);
                
                if (result.success) {
                    // å¦‚æœæ˜¯Base64æ•°æ®ï¼Œéœ€è¦è½¬æ¢å›ArrayBuffer
                    let fileData;
                    if (typeof result.data === 'string') {
                        // Base64å­—ç¬¦ä¸²è½¬æ¢ä¸ºArrayBuffer
                        const binaryString = atob(result.data);
                        const bytes = new Uint8Array(binaryString.length);
                        for (let i = 0; i < binaryString.length; i++) {
                            bytes[i] = binaryString.charCodeAt(i);
                        }
                        fileData = bytes.buffer;
                    } else {
                        fileData = result.data;
                    }
                    
                    // åˆ›å»ºæ–‡ä»¶å†…å®¹æŸ¥çœ‹å™¨
                    showFileViewer(fileName, fileData);
                } else {
                    showError('æŸ¥çœ‹æ–‡ä»¶å¤±è´¥: ' + result.error);
                }
            } catch (error) {
                console.error('æŸ¥çœ‹æ–‡ä»¶é”™è¯¯:', error);
                showError('æŸ¥çœ‹æ–‡ä»¶æ—¶å‘ç”Ÿé”™è¯¯: ' + error.message);
            }
        }

        // æ˜¾ç¤ºæ–‡ä»¶å†…å®¹æŸ¥çœ‹å™¨
        function showFileViewer(fileName, fileData) {
            const extension = fileName.toLowerCase().split('.').pop();
            let content = '';
            
            if (['txt', 'log', 'ini', 'conf', 'md', 'json', 'xml', 'csv', 'jpg', 'jpeg', 'png', 'gif', 'bmp', 'webp', 'jsp', 'jspx', 'html', 'py', 'sh', 'js', 'css', 'bat'].includes(extension)) {
                // æ–‡æœ¬æ–‡ä»¶
                try {
                    content = new TextDecoder('utf-8').decode(fileData);
                } catch (e) {
                    content = 'æ–‡ä»¶ç¼–ç æ— æ³•è¯†åˆ«æˆ–æ–‡ä»¶è¿‡å¤§';
                }
                
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                    background: white; padding: 20px; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                    z-index: 1000; max-width: 80vw; max-height: 80vh; overflow: auto;
                `;
                modal.innerHTML = `
                    <h3>æ–‡ä»¶å†…å®¹: ${fileName}</h3>
                    <pre style="background: #f8f9fa; padding: 15px; border-radius: 5px; white-space: pre-wrap; word-wrap: break-word; max-height: 400px; overflow: auto;">${content}</pre>
                    <button class="btn btn-primary" onclick="this.parentElement.parentElement.remove()" style="margin-top: 10px;">
                        å…³é—­
                    </button>
                `;
                
                // æ·»åŠ èƒŒæ™¯é®ç½©
                const overlay = document.createElement('div');
                overlay.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 999;';
                
                // å®‰å…¨ç§»é™¤æ¨¡æ€æ¡†çš„å‡½æ•°
                const safeRemoveModal = () => {
                    try {
                        if (overlay && overlay.parentNode) {
                            overlay.parentNode.removeChild(overlay);
                        }
                        if (modal && modal.parentNode) {
                            modal.parentNode.removeChild(modal);
                        }
                    } catch (e) {
                        console.warn('ç§»é™¤æ–‡æœ¬æŸ¥çœ‹å™¨æ—¶å‡ºé”™:', e);
                    }
                };
                
                overlay.onclick = safeRemoveModal;
                
                document.body.appendChild(overlay);
                document.body.appendChild(modal);
                
                // ä¿®æ”¹å…³é—­æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶
                setTimeout(() => {
                    const closeBtn = modal.querySelector('button[onclick*="remove"]');
                    if (closeBtn) {
                        closeBtn.onclick = safeRemoveModal;
                    }
                }, 100);
                
            } else if (['jpg', 'jpeg', 'png', 'gif', 'bmp', 'webp'].includes(extension)) {
                // å›¾ç‰‡æ–‡ä»¶
                const blob = new Blob([fileData]);
                const url = URL.createObjectURL(blob);
                
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                    background: white; padding: 20px; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                    z-index: 1000; max-width: 90vw; max-height: 90vh; text-align: center;
                `;
                modal.innerHTML = `
                    <h3>å›¾ç‰‡: ${fileName}</h3>
                    <img src="${url}" style="max-width: 100%; max-height: 60vh; object-fit: contain;">
                    <br><button class="btn btn-primary" onclick="this.parentElement.parentElement.remove(); URL.revokeObjectURL(this.previousElementSibling.src)" style="margin-top: 10px;">
                        å…³é—­
                    </button>
                `;
                
                // æ·»åŠ èƒŒæ™¯é®ç½©
                const overlay = document.createElement('div');
                overlay.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 999;';
                
                // å®‰å…¨ç§»é™¤æ¨¡æ€æ¡†çš„å‡½æ•°
                const safeRemoveModal = () => {
                    try {
                        if (url) {
                            URL.revokeObjectURL(url);
                        }
                        if (overlay && overlay.parentNode) {
                            overlay.parentNode.removeChild(overlay);
                        }
                        if (modal && modal.parentNode) {
                            modal.parentNode.removeChild(modal);
                        }
                    } catch (e) {
                        console.warn('ç§»é™¤å›¾ç‰‡æŸ¥çœ‹å™¨æ—¶å‡ºé”™:', e);
                    }
                };
                
                overlay.onclick = safeRemoveModal;
                
                document.body.appendChild(overlay);
                document.body.appendChild(modal);
                
                // ä¿®æ”¹å…³é—­æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶
                setTimeout(() => {
                    const closeBtn = modal.querySelector('button[onclick*="remove"]');
                    if (closeBtn) {
                        closeBtn.onclick = safeRemoveModal;
                    }
                }, 100);
                
            } else {
                // å…¶ä»–ç±»å‹æ–‡ä»¶æç¤ºä¸‹è½½
                alert('æ­¤æ–‡ä»¶ç±»å‹ä¸æ”¯æŒåœ¨çº¿é¢„è§ˆï¼Œè¯·ä¸‹è½½åæŸ¥çœ‹');
            }
        }

        // æŸ¥çœ‹æ–‡ä»¶ä¿¡æ¯
        async function viewFileInfo(fileName) {
            if (!currentShare) {
                showError('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªå…±äº«æ–‡ä»¶å¤¹');
                return;
            }
            
            try {
                console.log('æŸ¥çœ‹æ–‡ä»¶ä¿¡æ¯ - å½“å‰å…±äº«:', currentShare, 'å½“å‰è·¯å¾„:', currentPath, 'æ–‡ä»¶å:', fileName);
                
                // æ„é€ æ­£ç¡®çš„æ–‡ä»¶è·¯å¾„
                let filePath;
                if (currentPath === '\\') {
                    // æ ¹ç›®å½•ï¼Œç›´æ¥ä½¿ç”¨æ–‡ä»¶å
                    filePath = fileName;
                } else if (currentPath.startsWith('\\' + currentShare)) {
                    // å¦‚æœå½“å‰è·¯å¾„åŒ…å«å…±äº«åï¼Œåˆ™æå–ç›¸å¯¹è·¯å¾„
                    const relativePath = currentPath.substring(('\\' + currentShare).length).replace(/^\\+/, '');
                    filePath = relativePath ? relativePath + '\\' + fileName : fileName;
                } else {
                    // å¦åˆ™ç›´æ¥æ‹¼æ¥
                    const cleanPath = currentPath.replace(/^\\+/, '').replace(/\\+$/, '');
                    filePath = cleanPath ? cleanPath + '\\' + fileName : fileName;
                }
                
                console.log('æ„é€ çš„æ–‡ä»¶è·¯å¾„:', filePath);
                
                console.log('â„¹ï¸ [å‰ç«¯è°ƒç”¨] å‡†å¤‡è°ƒç”¨ pywebview.api.get_file_info');
                console.log('â„¹ï¸ [å‰ç«¯è°ƒç”¨] å‚æ•°:', { currentShare, filePath });
                const result = await pywebview.api.get_file_info(currentShare, filePath);
                console.log('â„¹ï¸ [å‰ç«¯è°ƒç”¨] pywebview.api.get_file_info è¿”å›:', result);
                
                if (result.success) {
                    alert(`æ–‡ä»¶ä¿¡æ¯:\n\nåç§°: ${result.name}\nå¤§å°: ${formatFileSize(result.size)}\nåˆ›å»ºæ—¶é—´: ${result.created_time}\nä¿®æ”¹æ—¶é—´: ${result.modified_time}\nå±æ€§: ${result.attributes}`);
                } else {
                    showError(`è·å–æ–‡ä»¶ä¿¡æ¯å¤±è´¥: ${result.error}`);
                }
            } catch (error) {
                showError(`è·å–æ–‡ä»¶ä¿¡æ¯é”™è¯¯: ${error.message}`);
            }
        }

        // æ›´æ–°åˆ†é¡µ
        function updatePagination(totalItems) {
            const totalPages = Math.ceil(totalItems / itemsPerPage);
            
            document.getElementById('prevBtn').disabled = currentPage <= 1;
            document.getElementById('nextBtn').disabled = currentPage >= totalPages;
            
            document.querySelector('.page-info').textContent = 
                totalItems > 0 ? `ç¬¬ ${currentPage} é¡µï¼Œå…± ${totalPages} é¡µ (${totalItems} ä¸ªé¡¹ç›®)` : 'ç¬¬ 1 é¡µï¼Œå…± 1 é¡µ';
        }

        // è½¬ä¹‰è·¯å¾„ä¸­çš„ç‰¹æ®Šå­—ç¬¦ï¼Œç¡®ä¿åœ¨onclickä¸­æ­£ç¡®ä¼ é€’
        function escapePath(path) {
            return path.replace(/\\/g, '\\\\').replace(/'/g, "\\'").replace(/"/g, '\\"');
        }

        // æ›´æ–°é¢åŒ…å±‘å¯¼èˆª
        function updateBreadcrumb() {
            // è§£æå½“å‰è·¯å¾„ï¼Œåˆ†ç¦»å…±äº«åå’Œå­è·¯å¾„
            let shareName = '';
            let subPath = '';
            
            if (currentPath && currentPath !== '\\' && currentPath !== '\\\\') {
                const parts = currentPath.split('\\').filter(p => p);
                if (parts.length > 0) {
                    // ç¬¬ä¸€ä¸ªéƒ¨åˆ†åº”è¯¥æ˜¯å…±äº«å
                    shareName = parts[0];
                    if (parts.length > 1) {
                        subPath = parts.slice(1).join('\\');
                    }
                }
            }
            
            let breadcrumbHTML = '<span class="breadcrumb-item" onclick="navigateToPath(\\\\\\\'\\\\\\\\\\\')"><i class="fas fa-home"></i></span>';
            
            if (shareName) {
                breadcrumbHTML += ' <span>/</span> ';
                // è½¬ä¹‰å…±äº«åè·¯å¾„
                const sharePath = '\\' + shareName;
                const escapedSharePath = escapePath(sharePath);
                breadcrumbHTML += `<span class="breadcrumb-item" onclick="navigateToPath('${escapedSharePath}')">${shareName}</span>`;
                
                // å¦‚æœæœ‰å­è·¯å¾„ï¼Œç»§ç»­æ·»åŠ å­è·¯å¾„éƒ¨åˆ†
                if (subPath) {
                    const subParts = subPath.split('\\');
                    let buildSubPath = '';
                    
                    for (let i = 0; i < subParts.length; i++) {
                        buildSubPath += (buildSubPath ? '\\' : '') + subParts[i];
                        const fullPath = '\\' + shareName + (buildSubPath ? '\\' + buildSubPath : '');
                        const escapedFullPath = escapePath(fullPath);
                        breadcrumbHTML += ' <span>/</span> ';
                        breadcrumbHTML += `<span class="breadcrumb-item" onclick="navigateToPath('${escapedFullPath}')">${subParts[i]}</span>`;
                    }
                }
            }
            
            elements.breadcrumb.innerHTML = breadcrumbHTML;
        }

        // å¯¼èˆªåˆ°æŒ‡å®šè·¯å¾„
        function navigateToPath(path) {
            // è·¯å¾„å·²ç»åœ¨HTMLä¸­æ­£ç¡®è½¬ä¹‰ï¼Œç›´æ¥ä½¿ç”¨
            currentPath = path;
            currentPage = 1;
            loadFiles(currentPath);
            updateBreadcrumb();
        }

        // è·å–çˆ¶ç›®å½•è·¯å¾„
        function getParentPath(path) {
            if (!path || path === '\\' || path === '\\\\') return '\\';
            
            const parts = path.split('\\').filter(p => p);
            parts.pop();
            
            if (parts.length === 0) return '\\';
            
            return '\\' + parts.join('\\');
        }

        // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // åˆ†é¡µæŒ‰é’®äº‹ä»¶
        document.getElementById('prevBtn').addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                displayFiles();
            }
        });

        document.getElementById('nextBtn').addEventListener('click', () => {
            const totalPages = Math.ceil(allFiles.length / itemsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                displayFiles();
            }
        });

        // å·¥å…·æ æŒ‰é’®äº‹ä»¶
        document.getElementById('refreshBtn').addEventListener('click', () => {
            if (currentShare) {
                loadFiles(currentPath);
            } else {
                loadShares();
            }
        });

        document.getElementById('uploadBtn').addEventListener('click', () => {
            if (!currentShare) {
                showError('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªå…±äº«æ–‡ä»¶å¤¹');
                return;
            }
            openUploadModal();
        });

        document.getElementById('disconnectBtn').addEventListener('click', async () => {
            if (confirm('ç¡®å®šè¦æ–­å¼€å½“å‰è¿æ¥å—ï¼Ÿ')) {
                try {
                    console.log('ğŸ”Œ [å‰ç«¯è°ƒç”¨] å‡†å¤‡è°ƒç”¨ pywebview.api.disconnect');
                console.log('ğŸ”Œ [å‰ç«¯è°ƒç”¨] å‚æ•°: æ— ');
                const result = await pywebview.api.disconnect();
                console.log('ğŸ”Œ [å‰ç«¯è°ƒç”¨] pywebview.api.disconnect è¿”å›:', result);
                    if (result.success) {
                        showLoginPage();
                    } else {
                        showError(result.error);
                    }
                } catch (error) {
                    showError('æ–­å¼€è¿æ¥é”™è¯¯: ' + error.message);
                }
            }
        });

        // ä¸Šä¼ æ–‡ä»¶ç›¸å…³åŠŸèƒ½
        function openUploadModal() {
            elements.uploadModal.classList.add('show');
        }

        function closeUploadModal() {
            elements.uploadModal.classList.remove('show');
            elements.uploadPreview.innerHTML = '';
        }

        // æ–‡ä»¶æ‹–æ‹½ä¸Šä¼ 
        elements.dropArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            elements.dropArea.classList.add('dragover');
        });

        elements.dropArea.addEventListener('dragleave', () => {
            elements.dropArea.classList.remove('dragover');
        });

        elements.dropArea.addEventListener('drop', (e) => {
            e.preventDefault();
            elements.dropArea.classList.remove('dragover');
            
            const files = Array.from(e.dataTransfer.files);
            displayUploadPreview(files);
        });

        elements.fileInput.addEventListener('change', (e) => {
            const files = Array.from(e.target.files);
            displayUploadPreview(files);
        });

        function displayUploadPreview(files) {
            const html = files.map(file => `
                <div class="upload-item" data-filename="${file.name}" data-filesize="${file.size}">
                    <div>
                        <strong>${file.name}</strong><br>
                        <small>å¤§å°: ${formatFileSize(file.size)}</small>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 0%"></div>
                    </div>
                </div>
            `).join('');
            
            elements.uploadPreview.innerHTML = html;
        }

        async function startUpload() {
            const fileInput = document.getElementById('fileInput');
            const files = Array.from(fileInput.files);
            
            if (files.length === 0) {
                showError('è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶');
                return;
            }
            
            for (const file of files) {
                try {
                    // æ˜¾ç¤ºä¸Šä¼ è¿›åº¦
                    const uploadItem = document.querySelector(`[data-filename="${file.name}"]`);
                    const progressFill = uploadItem.querySelector('.progress-fill');
                    
                    // è¯»å–æ–‡ä»¶
                    const fileData = await readFile(file);
                    
                    // æ„å»ºä¸Šä¼ è·¯å¾„
                    console.log('ä¸Šä¼ æ–‡ä»¶ - å½“å‰å…±äº«:', currentShare, 'å½“å‰è·¯å¾„:', currentPath, 'æ–‡ä»¶å:', file.name);
                
                // æ„é€ æ­£ç¡®çš„æ–‡ä»¶è·¯å¾„
                let filePath;
                if (currentPath === '\\') {
                    // æ ¹ç›®å½•ï¼Œç›´æ¥ä½¿ç”¨æ–‡ä»¶å
                    filePath = file.name;
                } else if (currentPath.startsWith('\\' + currentShare)) {
                    // å¦‚æœå½“å‰è·¯å¾„åŒ…å«å…±äº«åï¼Œåˆ™æå–ç›¸å¯¹è·¯å¾„
                    const relativePath = currentPath.substring(('\\' + currentShare).length).replace(/^\\+/, '');
                    filePath = relativePath ? relativePath + '\\' + file.name : file.name;
                } else {
                    // å¦åˆ™ç›´æ¥æ‹¼æ¥
                    const cleanPath = currentPath.replace(/^\\+/, '').replace(/\\+$/, '');
                    filePath = cleanPath ? cleanPath + '\\' + file.name : file.name;
                }
                
                console.log('æ„é€ çš„æ–‡ä»¶è·¯å¾„:', filePath);
                    
                progressFill.style.width = '50%';
                
                // ä¸Šä¼ æ–‡ä»¶
                console.log('â¬†ï¸ [å‰ç«¯è°ƒç”¨] å‡†å¤‡è°ƒç”¨ pywebview.api.upload_file');
                    console.log('â¬†ï¸ [å‰ç«¯è°ƒç”¨] å‚æ•°:', { currentShare, filePath, fileData_size: fileData ? fileData.length : 0 });
                    const result = await pywebview.api.upload_file(currentShare, filePath, fileData);
                    console.log('â¬†ï¸ [å‰ç«¯è°ƒç”¨] pywebview.api.upload_file è¿”å›:', result);
                    
                    if (result.success) {
                        progressFill.style.width = '100%';
                        progressFill.style.background = '#28a745';
                        showSuccess(`æ–‡ä»¶ ${file.name} ä¸Šä¼ æˆåŠŸï¼`);
                    } else {
                        progressFill.style.width = '100%';
                        progressFill.style.background = '#dc3545';
                        showError(`æ–‡ä»¶ ${file.name} ä¸Šä¼ å¤±è´¥: ${result.error}`);
                    }
                } catch (error) {
                    showError(`ä¸Šä¼  ${file.name} æ—¶å‡ºé”™: ${error.message}`);
                }
            }
            
            // åˆ·æ–°æ–‡ä»¶åˆ—è¡¨
            setTimeout(() => {
                loadFiles(currentPath);
                closeUploadModal();
            }, 2000);
        }

        function readFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const uint8Array = new Uint8Array(e.target.result);
                    // è½¬æ¢ä¸ºBase64å­—ç¬¦ä¸²ä»¥ä¾¿JSONåºåˆ—åŒ– - åˆ†æ‰¹å¤„ç†é¿å…æ ˆæº¢å‡º
                    const base64 = encodeBase64(uint8Array);
                    resolve(base64);
                };
                reader.onerror = reject;
                reader.readAsArrayBuffer(file);
            });
        }
        
        // åˆ†æ‰¹ç¼–ç Base64é¿å…æ ˆæº¢å‡º
        function encodeBase64(uint8Array) {
            const chunkSize = 8192; // 8KB chunks
            let result = '';
            
            for (let i = 0; i < uint8Array.length; i += chunkSize) {
                const chunk = uint8Array.slice(i, i + chunkSize);
                const binaryString = String.fromCharCode.apply(null, chunk);
                result += btoa(binaryString);
            }
            
            return result;
        }

        // æ¨¡æ€æ¡†ç‚¹å‡»å¤–éƒ¨å…³é—­
        elements.uploadModal.addEventListener('click', (e) => {
            if (e.target === elements.uploadModal) {
                closeUploadModal();
            }
        });

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOMåŠ è½½å®Œæˆï¼Œç­‰å¾…PyWebViewåˆå§‹åŒ–...');
            
            // è®¾ç½®åˆå§‹çŠ¶æ€
            toggleConnectionType();
            toggleAuthType();
            
            // ç­‰å¾…PyWebView APIå¯ç”¨
            waitForPyWebView();
        });

        // ç­‰å¾…PyWebView APIåˆå§‹åŒ–å®Œæˆ
        function waitForPyWebView() {
            if (typeof pywebview !== 'undefined' && pywebview.api) {
                console.log('PyWebView APIå·²å°±ç»ªï¼Œåº”ç”¨å¯ä»¥æ­£å¸¸ä½¿ç”¨');
                console.log('SMB Client GUI åˆå§‹åŒ–å®Œæˆï¼');
            } else {
                console.log('ç­‰å¾…PyWebView APIåˆå§‹åŒ–...');
                setTimeout(waitForPyWebView, 100);
            }
        }

        // æ£€æŸ¥PyWebViewæ˜¯å¦å°±ç»ª
        function checkPyWebViewReady() {
            if (typeof pywebview === 'undefined' || !pywebview.api) {
                console.error('PyWebView APIæœªå°±ç»ª');
                return false;
            }
            return true;
        }
    </script>
</body>
</html>